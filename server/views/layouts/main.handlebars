<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}}</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=VT323&display=swap" rel="stylesheet">
    {{#if user.profileCss}}
        <style id="user-custom-css">
            /* User's custom CSS for profile pages */
            {{#if isProfilePage}}
                {{{user.profileCss}}}
            {{/if}}
        </style>
    {{/if}}
</head>
<body class="theme-{{pageTheme}}">
    <div class="page-wrapper">
        <header class="main-header">
            <div class="logo">
                <a href="/">
                    <img src="/images/wirebase-logo.svg" alt="Wirebase Logo" class="pixel-image">
                    <h1>Wirebase</h1>
                </a>
            </div>
            <nav class="win98-navbar">
                <a href="/" class="win98-button">Home</a>
                {{#if isAuthenticated}}
                    <a href="/profile" class="win98-button">Profile</a>
                {{else}}
                    <a href="/users/login" class="win98-button">Login</a>
                {{/if}}
                <a href="/scrapyard" class="win98-button">Scrapyard</a>
                <a href="/discover" class="win98-button">Discover</a>
                <a href="/forum" class="win98-button">Forum</a>
                {{#if isAuthenticated}}
                    <a href="/users/logout" class="win98-button">Logout</a>
                {{else}}
                    <a href="/users/register" class="win98-button">Register</a>
                {{/if}}
            </nav>
        </header>

        <div class="flash-messages">
            {{#if success_msg}}
                <div class="win98-window flash-message success">
                    <div class="win98-window-header">
                        <span class="win98-window-title">Success</span>
                        <div class="win98-window-controls">
                            <span class="win98-window-control close-flash">×</span>
                        </div>
                    </div>
                    <div class="win98-window-content">
                        {{success_msg}}
                    </div>
                </div>
            {{/if}}
            
            {{#if error_msg}}
                <div class="win98-window flash-message error">
                    <div class="win98-window-header">
                        <span class="win98-window-title">Error</span>
                        <div class="win98-window-controls">
                            <span class="win98-window-control close-flash">×</span>
                        </div>
                    </div>
                    <div class="win98-window-content">
                        {{error_msg}}
                    </div>
                </div>
            {{/if}}
            
            {{#if errors}}
                <div class="win98-window flash-message error">
                    <div class="win98-window-header">
                        <span class="win98-window-title">Error</span>
                        <div class="win98-window-controls">
                            <span class="win98-window-control close-flash">×</span>
                        </div>
                    </div>
                    <div class="win98-window-content">
                        <ul class="error-list">
                            {{#each errors}}
                                <li>{{this.msg}}</li>
                            {{/each}}
                        </ul>
                    </div>
                </div>
            {{/if}}
        </div>

        <main class="container">
            {{{body}}}
        </main>

        <footer class="main-footer">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="/images/wirebase-logo.svg" alt="Wirebase Logo" class="pixel-image small">
                    <span>Wirebase</span>
                </div>
                <div class="footer-links">
                    <a href="/about">About</a>
                    <a href="/terms">Terms</a>
                    <a href="/privacy">Privacy</a>
                    <a href="/faq">FAQ</a>
                </div>
            </div>
            <div class="footer-copyright">
                © 2025 Wirebase - Medieval Dungeon Fantasy Social Platform
            </div>
        </footer>
    </div>

    {{#if user.isAuthenticated}}
        <div class="user-status-bar">
            <div class="user-info">
                <img src="{{user.avatar}}" alt="{{user.displayName}}" class="user-avatar-small">
                <span class="user-name">{{user.displayName}}</span>
                <span class="user-glyph">{{user.customGlyph}}</span>
            </div>
            <div class="loot-tokens">
                <span class="token-icon">⚜️</span>
                <span class="token-count">{{user.lootTokens}}</span>
            </div>
        </div>
    {{/if}}

    <script src="/js/main.js"></script>
    {{#if additionalScripts}}
        {{#each additionalScripts}}
            <script src="{{this}}"></script>
        {{/each}}
    {{/if}}
</body>
</html>